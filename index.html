<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>DIP • Archivo Vivo — Cinema Preview</title>

<style>
:root{
  --ink: rgba(235,245,255,.92);
  --muted: rgba(235,245,255,.56);
  --line: rgba(160,190,220,.14);
  --accent: rgba(60,255,190,.95);
  --shadow: rgba(0,0,0,.75);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  overflow:hidden;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  color:var(--ink);
  background:
    radial-gradient(1200px 800px at 20% 15%, rgba(30,60,90,.35), transparent 60%),
    radial-gradient(900px 700px at 80% 85%, rgba(8,18,30,.85), transparent 55%),
    linear-gradient(180deg, #070b12, #05070c);
}

/* HUD */
.hud{
  position:fixed;
  top:12px; left:12px; right:12px;
  display:flex; gap:10px; align-items:center;
  z-index:10;
}
.badge{
  padding:10px 14px;
  border-radius:16px;
  background: rgba(10,14,20,.40);
  border:1px solid var(--line);
  backdrop-filter: blur(12px);
}
.badge .t1{
  font-size:12px;
  letter-spacing:.22em;
  text-transform:uppercase;
  color:rgba(235,245,255,.72);
}
.badge .t2{
  font-size:12px;
  color:rgba(235,245,255,.40);
}
.panel{
  flex:1;
  display:flex;
  gap:8px;
  padding:10px 12px;
  border-radius:16px;
  background: linear-gradient(180deg, rgba(12,18,28,.85), rgba(8,12,18,.60));
  border:1px solid var(--line);
  backdrop-filter: blur(12px);
  box-shadow: 0 18px 70px rgba(0,0,0,.55);
}
.panel input{
  flex:1;
  padding:11px 12px;
  border-radius:14px;
  border:1px solid rgba(160,190,220,.25);
  background: rgba(0,0,0,.35);
  color:var(--ink);
  font-size:16px;
  text-transform:uppercase;
  outline:none;
}
.panel button{
  padding:11px 14px;
  border-radius:14px;
  border:1px solid rgba(60,255,190,.35);
  background: linear-gradient(180deg, rgba(60,255,190,.18), rgba(60,255,190,.06));
  color:var(--ink);
  cursor:pointer;
}

/* VIEWPORT */
.viewport{
  position:fixed;
  top:80px; left:12px; right:12px; bottom:12px;
  border-radius:22px;
  border:1px solid var(--line);
  background:
    radial-gradient(900px 600px at 50% 40%, rgba(90,210,255,.07), transparent 65%),
    linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.78));
  box-shadow: 0 40px 120px rgba(0,0,0,.75);
  overflow:hidden;
}
.world{
  position:absolute;
  inset:-20%;
  transform-origin:50% 56%;
  will-change:transform, filter;
}

/* Escena */
.floor{
  position:absolute;
  inset:-10%;
  background:
    linear-gradient(rgba(120,150,180,.12) 1px, transparent 1px),
    linear-gradient(90deg, rgba(120,150,180,.12) 1px, transparent 1px);
  background-size:64px 64px;
  transform: perspective(1000px) rotateX(78deg) translateY(160px);
  opacity:.22;
}
.shelf{
  position:absolute;
  top:10%; bottom:10%;
  width:28%;
  border-radius:18px;
  border:1px solid var(--line);
  background: rgba(10,14,20,.30);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
}
.shelf.left{
  left:6%;
  transform: perspective(1100px) rotateY(52deg) translateZ(-140px);
}
.shelf.right{
  right:6%;
  transform: perspective(1100px) rotateY(-52deg) translateZ(-140px);
}
.drawers{
  position:absolute;
  inset:12px;
  display:grid;
  grid-template-columns: repeat(2,1fr);
  grid-auto-rows:70px;
  gap:10px;
}
.drawer{
  position:relative;
  border-radius:14px;
  border:1px solid var(--line);
  background: linear-gradient(180deg, rgba(30,40,58,.28), rgba(8,12,18,.30));
  overflow:hidden;
}
.drawer .id{
  position:absolute;
  left:10px; top:10px;
  font-size:11px;
  letter-spacing:.16em;
  color:var(--muted);
}
.drawer .tag{
  position:absolute;
  right:10px; bottom:10px;
  font-size:10px;
  letter-spacing:.20em;
  color:rgba(235,245,255,.30);
  text-transform:uppercase;
}

/* Clímax */
.drawer.active{
  border-color: rgba(60,255,190,.55);
  box-shadow: 0 0 0 1px rgba(60,255,190,.35),
              0 0 120px rgba(60,255,190,.16);
}
.drawer.active::after{
  content:"";
  position:absolute;
  inset:-40%;
  background: radial-gradient(circle at 50% 50%, rgba(60,255,190,.70), transparent 55%);
  animation:pulse 1.1s ease-in-out infinite;
}
@keyframes pulse{
  0%,100%{transform:scale(.88);opacity:.32}
  50%{transform:scale(1.14);opacity:.95}
}

/* “Apertura” simulada del cajón */
.drawer.open .lid{
  transform: translateY(-65%);
  opacity:.95;
}
.lid{
  position:absolute;
  inset:0;
  background: linear-gradient(180deg, rgba(60,255,190,.20), rgba(60,255,190,.02));
  border-top: 1px solid rgba(60,255,190,.25);
  transform: translateY(0);
  opacity:0;
  transition: transform 750ms cubic-bezier(.2,.9,.2,1), opacity 500ms ease;
}
.drawer.open .lid{ opacity:1; }

/* Atmósfera */
.fog{
  position:absolute;
  inset:0;
  background: radial-gradient(60% 50% at 50% 45%, rgba(90,210,255,.10), rgba(0,0,0,.80));
  pointer-events:none;
  opacity:.85;
  transition: opacity 700ms ease;
}
.vignette{
  position:absolute;
  inset:0;
  background: radial-gradient(70% 55% at 50% 45%, transparent 0%, rgba(0,0,0,.65) 75%, rgba(0,0,0,.88) 100%);
  pointer-events:none;
  opacity:.90;
  transition: opacity 700ms ease;
}
.cineDim{
  filter: brightness(.82) contrast(1.12);
}

/* Status */
.status{
  position:fixed;
  right:14px; bottom:14px;
  padding:8px 12px;
  border-radius:999px;
  background: rgba(10,14,20,.40);
  border:1px solid var(--line);
  font-size:12px;
  backdrop-filter: blur(10px);
  z-index:10;
}

/* Card final */
.card{
  position:fixed;
  left:50%; top:56%;
  transform: translate(-50%,-50%);
  width:min(640px, 92vw);
  border-radius:22px;
  padding:14px;
  background: linear-gradient(180deg, rgba(10,14,20,.86), rgba(8,10,14,.76));
  border: 1px solid rgba(60,255,190,.26);
  box-shadow: 0 18px 70px rgba(0,0,0,.62);
  backdrop-filter: blur(12px);
  z-index:20;
  display:none;
}
.card.show{display:block}
.card h3{
  margin:2px 0 6px 0;
  font-size:14px;
  letter-spacing:.14em;
  text-transform:uppercase;
}
.card p{
  margin:0 0 12px 0;
  font-size:12px;
  color: rgba(235,245,255,.56);
  line-height:1.35;
}
.actions{display:flex; gap:10px; flex-wrap:wrap}
.btn2{
  cursor:pointer;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid rgba(160,190,220,.18);
  background: rgba(0,0,0,.25);
  color: var(--ink);
}
.btn2.primary{
  border-color: rgba(60,255,190,.32);
  background: rgba(60,255,190,.10);
}

@media (max-width:720px){
  .drawers{grid-auto-rows:56px}
  .hud{gap:8px}
  .panel button{padding:11px 12px}
}
</style>
</head>

<body>

<div class="hud">
  <div class="badge">
    <div class="t1">DIP • Archivo Vivo</div>
    <div class="t2">Cinema — plano secuencia dirigido (preview)</div>
  </div>
  <div class="panel">
    <input id="q" value="INC-0123" placeholder="INC-0123">
    <button id="go">Buscar</button>
    <button id="reset">Reset</button>
  </div>
</div>

<div class="viewport" id="viewport">
  <div class="world" id="world">
    <div class="floor"></div>
    <div class="shelf left"><div class="drawers" id="L"></div></div>
    <div class="shelf right"><div class="drawers" id="R"></div></div>
    <div class="fog" id="fog"></div>
  </div>
  <div class="vignette" id="vig"></div>
</div>

<div class="status" id="status">Listo</div>

<div class="card" id="card">
  <h3 id="cardTitle">INC-0000</h3>
  <p>Hallazgo confirmado. Archivo desbloqueado en modo confidencial.</p>
  <div class="actions">
    <button class="btn2 primary" id="enter">Entrar / Ver informe</button>
    <button class="btn2" id="links">Ver vínculos</button>
    <button class="btn2" id="hist">Historial</button>
  </div>
</div>

<script>
/* ========= Parse INC ========= */
function parseINC(v){
  let s=(v||"").toUpperCase().trim().replace(/[–—−]/g,"-").replace(/\s+/g,"");
  const m=s.match(/^INC-(\d{1,6})$/);
  if(!m) return null;
  const n = parseInt(m[1],10);
  return { id:`INC-${m[1].padStart(4,"0")}`, n };
}

/* ========= Slot determinístico (consistente) ========= */
function locate(n){
  // “archivo” lógico: pasillo -> estante -> cajón
  const lane = Math.floor(n / 120) % 3;     // 0..2 (tres sectores)
  const side = (n % 2) ? "R" : "L";
  const slot = (Math.floor(n / 3) % 18);    // 0..17
  return { lane, side, slot };
}

/* ========= DOM ========= */
const L=document.getElementById("L");
const R=document.getElementById("R");
const world=document.getElementById("world");
const viewport=document.getElementById("viewport");
const status=document.getElementById("status");
const fog=document.getElementById("fog");
const vig=document.getElementById("vig");

const card=document.getElementById("card");
const cardTitle=document.getElementById("cardTitle");
const showCard = (id)=>{ cardTitle.textContent=id; card.classList.add("show"); };
const hideCard = ()=> card.classList.remove("show");

/* ========= Build shelves ========= */
function mkDrawer(i){
  const d=document.createElement("div");
  d.className="drawer";
  d.dataset.slot=i;
  d.innerHTML = `
    <div class="id">INC-****</div>
    <div class="tag">CONFIDENCIAL</div>
    <div class="lid"></div>
  `;
  return d;
}
function build(){
  L.innerHTML=""; R.innerHTML="";
  for(let i=0;i<18;i++){ L.appendChild(mkDrawer(i)); R.appendChild(mkDrawer(i)); }
}
build();

function clearAll(){
  hideCard();
  viewport.classList.remove("cineDim");
  fog.style.opacity = ".85";
  vig.style.opacity = ".90";
  document.querySelectorAll(".drawer").forEach(d=>{
    d.classList.remove("active","open");
    d.querySelector(".id").textContent="INC-****";
  });
  // reset camera-ish transform
  world.style.transform = "translate3d(0,0,0) rotateY(0deg) rotateZ(0deg) scale(1)";
}

/* ========= RECORRIDO CINEMATOGRÁFICO (4 etapas) ========= */
function travelSequence(lane){
  const t0 = performance.now();

  // lane cambia levemente la trayectoria para que “parezca real”
  const laneBias = [-14, 0, +12][lane] || 0;

  const D1=1200, D2=900, D3=900, D4=700;
  const TOTAL=D1+D2+D3+D4;

  const clamp01 = (x)=> Math.max(0, Math.min(1, x));
  const ease = (t)=> t*t*(3-2*t);

  function step(now){
    const ms = now - t0;
    const t = clamp01(ms / TOTAL);

    let x=0,y=0,ry=0,rz=0,s=1;

    if(ms <= D1){
      const p = ease(ms/D1);
      y = 18*p;
      s = 1 + .18*p;
      rz = -0.6*p;
      x = laneBias * 0.15 * p;
    } else if(ms <= D1+D2){
      const p = ease((ms-D1)/D2);
      y = 18 + 8*p;
      s = 1.18 + .14*p;
      x = 26*p + laneBias*0.22;
      ry = -18*p;
      rz = (-0.6 + 1.0*p);
    } else if(ms <= D1+D2+D3){
      const p = ease((ms-D1-D2)/D3);
      y = 26 + 8*p;
      s = 1.32 + .16*p;
      x = (26 - 44*p) + laneBias*0.28;
      ry = (-18 + 32*p);
      rz = (0.4 - 0.7*p);
    } else {
      const p = ease((ms-D1-D2-D3)/D4);
      y = 34 + 4*p;
      s = 1.48 + .08*p;
      x = (-18 + 8*p) + laneBias*0.18;
      ry = (14 - 4*p);
      rz = (-0.3 + 0.3*p);
    }

    // respiración cine
    const breathe = Math.sin(now*0.0022) * 0.35;
    x += breathe * 0.25;
    rz += breathe * 0.12;

    world.style.transform =
      `translate3d(${x}px,${y}px,0) rotateY(${ry}deg) rotateZ(${rz}deg) scale(${s})`;

    if(t < 1) requestAnimationFrame(step);
  }

  requestAnimationFrame(step);
}

/* ========= Buscar ========= */
document.getElementById("go").onclick = ()=>{
  const inc = parseINC(document.getElementById("q").value);
  if(!inc){ status.textContent="Formato inválido. Usá INC-0123"; return; }

  clearAll();

  const { lane, side, slot } = locate(inc.n);
  const col = (side==="L") ? L : R;
  const target = col.querySelector(`[data-slot="${slot}"]`);

  target.classList.add("active");
  target.querySelector(".id").textContent = inc.id;

  status.textContent = `Viaje iniciado → ${inc.id}`;

  // viaje
  travelSequence(lane);

  // clímax: apagar entorno + abrir cajón + mostrar opciones
  setTimeout(()=>{
    viewport.classList.add("cineDim");
    fog.style.opacity = "1";
    vig.style.opacity = "1";
    status.textContent = `Llegada → ${inc.id}`;
  }, 1200);

  setTimeout(()=>{
    target.classList.add("open");
    status.textContent = `Hallazgo ✅ ${inc.id}`;
    showCard(inc.id);
  }, 1900);
};

document.getElementById("reset").onclick = ()=>{
  clearAll();
  status.textContent = "Listo";
};

/* Acciones demo */
document.getElementById("enter").onclick = ()=> alert("Abrir informe (demo): " + cardTitle.textContent);
document.getElementById("links").onclick = ()=> alert("Vínculos (demo): " + cardTitle.textContent);
document.getElementById("hist").onclick  = ()=> alert("Historial (demo): " + cardTitle.textContent);

/* Autoplay */
setTimeout(()=> document.getElementById("go").click(), 700);
</script>

</body>
</html>
